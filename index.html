<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editable Organizational Chart</title>
    <script src="https://unpkg.com/gojs/release/go.js"></script>
    <script>
        function init() {
            var $ = go.GraphObject.make;
            var myDiagram = $(go.Diagram, "myDiagramDiv", {
                layout: $(go.TreeLayout, { angle: 90, layerSpacing: 50 })
            });

            // Define node template
            myDiagram.nodeTemplate = $(go.Node, "Auto",
                $(go.Shape, "Rectangle", { fill: "lightblue", stroke: "black" }),
                $(go.TextBlock, 
                    { margin: 8, editable: true }, // Make the text editable
                    new go.Binding("text", "label").makeTwoWay()
                ),
                {
                    contextMenu: $("ContextMenu",
                        $("ContextMenuButton",
                            $(go.TextBlock, "Add Node"),
                            { click: (e, obj) => addNode(obj.part.adornedPart.data.key) }
                        ),
                        $("ContextMenuButton",
                            $(go.TextBlock, "Delete Node"),
                            { click: (e, obj) => deleteNode(obj.part.adornedPart.data.key) }
                        )
                    )
                }
            );

            // Initial Data
            var nodeDataArray = [
                { key: "RegistrarGeneral", label: "Registrar General" },
                { key: "RegistrarJudicialService", parent: "RegistrarGeneral", label: "Registrar Judicial Service" },
                { key: "RegistrarAdmin", parent: "RegistrarGeneral", label: "Registrar Admin" },
                { key: "DeputyRegistrarAccounts", parent: "RegistrarGeneral", label: "Deputy Registrar Accounts" },
                { key: "AssistantRegistrarProtocol", parent: "RegistrarGeneral", label: "Assistant Registrar Protocol" },

                { key: "Accountant", parent: "DeputyRegistrarAccounts", label: "Accountant" },
                { key: "SeniorAdministrativeAssistantAccounts", parent: "DeputyRegistrarAccounts", label: "Senior Administrative Assistant" },
                { key: "JuniorAdministrativeAssistantAccounts", parent: "DeputyRegistrarAccounts", label: "Junior Administrative Assistant" },
                { key: "ComputerOperatorAccounts", parent: "DeputyRegistrarAccounts", label: "Computer Operator" },

                { key: "DeputyRegistrarProcurement", parent: "RegistrarAdmin", label: "Deputy Registrar Procurement" },
                { key: "LibrarianCumResearchOfficer", parent: "RegistrarAdmin", label: "Librarian cum Research Officer" },
                { key: "AssistantLibrarian", parent: "LibrarianCumResearchOfficer", label: "Assistant Librarian" },
                { key: "LibraryAssistants", parent: "AssistantLibrarian", label: "Library Assistants" },
                
                { key: "AssistantRegistrarEstablishment", parent: "RegistrarAdmin", label: "Assistant Registrar Establishment" },
                { key: "SeniorAdministrativeAssistantEstablishment", parent: "AssistantRegistrarEstablishment", label: "Senior Administrative Assistant" },
                { key: "JuniorAdministrativeAssistantEstablishment", parent: "AssistantRegistrarEstablishment", label: "Junior Administrative Assistant" },
                { key: "TypistEstablishment", parent: "AssistantRegistrarEstablishment", label: "Typist" },
                
                { key: "SeniorAdministrativeAssistantProcur", parent: "DeputyRegistrarProcurement", label: "Senior Administrative Assistant" },
                { key: "JuniorAdministrativeAssistantProcur", parent: "DeputyRegistrarProcurement", label: "Junior Administrative Assistant" },
                { key: "CourtOfficers", parent: "RegistrarAdmin", label: "Court Officers" },
                { key: "SeniorAdministrativeAssistantAdmin", parent: "RegistrarAdmin", label: "Senior Administrative Assistant (Recruitment)" },
                { key: "JuniorAdministrativeAssistantAdmin", parent: "RegistrarAdmin", label: "Junior Administrative Assistant (Recruitment)" },
                //{ key: "TypistAdmin", parent: "RegistrarAdmin", label: "Typist" },

                { key: "JointRegistrarListing", parent: "RegistrarJudicialService", label: "Joint Registrar Listing" },
                { key: "AssistantRegistrarII", parent: "JointRegistrarListing", label: "Assistant Registrar II" },
                { key: "AssistantRegistrarFiling", parent: "JointRegistrarListing", label: "Assistant Registrar Filing" },

                { key: "AssistantRegistrarEstablishmentJudicial", parent: "RegistrarJudicialService", label: "Assistant Registrar Establishment" },
                { key: "SeniorAdministrativeAssistantJudicialEstablishment", parent: "AssistantRegistrarEstablishmentJudicial", label: "Senior Administrative Assistant" },
                { key: "JuniorAdministrativeAssistantJudicialEstablishment", parent: "AssistantRegistrarEstablishmentJudicial", label: "Junior Administrative Assistant" },
                { key: "TypistJudicialEstablishment", parent: "AssistantRegistrarEstablishmentJudicial", label: "Typist" },

                { key: "DeputyRegistrarProcurementJudicial", parent: "RegistrarJudicialService", label: "Deputy Registrar Procurement" },
                { key: "ManagerIT", parent: "RegistrarJudicialService", label: "Manager IT" },
                { key: "SystemAnalyst", parent: "ManagerIT", label: "System Analyst" },
                { key: "SystemOfficer", parent: "ManagerIT", label: "System Officer" },
                { key: "SeniorAdministrativeAssistantIT", parent: "ManagerIT", label: "Senior Administrative Assistant" },
                { key: "JuniorAdministrativeAssistantIT", parent: "ManagerIT", label: "Junior Administrative Assistant" },
                { key: "ComputerOperatorIT", parent: "ManagerIT", label: "Computer Operator" },
                { key: "TypistIT", parent: "ManagerIT", label: "Typist" },
                { key: "SeniorAdministrativeAssistantProcurJud", parent: "DeputyRegistrarProcurementJudicial", label: "Senior Administrative Assistant" },
                { key: "JuniorAdministrativeAssistantProcurJud", parent: "DeputyRegistrarProcurementJudicial", label: "Junior Administrative Assistant" },

                { key: "SuperintendentJudicial", parent: "AssistantRegistrarII", label: "Superintendent" },
                { key: "Superintendent", parent: "AssistantRegistrarFiling", label: "Superintendent" },
                { key: "StampReporter", parent: "AssistantRegistrarII", label: "Stamp Reporter" },
                { key: "StampReporterFiling", parent: "AssistantRegistrarFiling", label: "Stamp Reporter" },
                { key: "CourtMastersJudicial", parent: "SuperintendentJudicial", label: "Court Masters" },
                { key: "SeniorAdministrativeAssistantJudicial", parent: "SuperintendentJudicial", label: "Senior Administrative Assistant" },
                { key: "JuniorAdministrativeAssistantJudicial", parent: "SuperintendentJudicial", label: "Junior Administrative Assistant" },
                { key: "CourtMasters", parent: "Superintendent", label: "Court Masters" },
                { key: "SeniorAdministrativeAssistant", parent: "Superintendent", label: "Senior Administrative Assistant" },
                { key: "JuniorAdministrativeAssistant", parent: "Superintendent", label: "Junior Administrative Assistant" },

                { key: "ProtocolOfficer", parent: "AssistantRegistrarProtocol", label: "Protocol Officer" },
                { key: "AssistantProtocolOfficer", parent: "AssistantRegistrarProtocol", label: "Assistant Protocol Officer" },
                { key: "SeniorAdministrativeAssistantProtocol", parent: "ProtocolOfficer", label: "Senior Administrative Assistant" },
                { key: "JuniorAdministrativeAssistantProtocol", parent: "ProtocolOfficer", label: "Junior Administrative Assistant" },
                { key: "SeniorAdministrativeAssistantAssistantProtocolOfficer", parent: "AssistantProtocolOfficer", label: "Senior Administrative Assistant" },
                { key: "JuniorAdministrativeAssistantAssistantProtocolOfficer", parent: "AssistantProtocolOfficer", label: "Junior Administrative Assistant" }
            ];
            myDiagram.model = new go.TreeModel(nodeDataArray);

            // Function to add a new node
            function addNode(parentKey) {
                var newKey = "Node" + Math.floor(Math.random() * 1000); // Unique ID
                var newNode = { key: newKey, parent: parentKey, label: "New Node" };

                myDiagram.startTransaction("Add Node");
                myDiagram.model.addNodeData(newNode);
                myDiagram.commitTransaction("Add Node");
            }

            // Function to delete a node and its children
            function deleteNode(nodeKey) {
                myDiagram.startTransaction("Delete Node");

                var toDelete = [];
                function collectChildren(key) {
                    toDelete.push(key);
                    myDiagram.model.nodeDataArray.forEach(n => {
                        if (n.parent === key) collectChildren(n.key);
                    });
                }
                collectChildren(nodeKey);

                toDelete.forEach(key => {
                    var node = myDiagram.findNodeForKey(key);
                    if (node) myDiagram.model.removeNodeData(node.data);
                });

                myDiagram.commitTransaction("Delete Node");
            }
        }
    </script>
</head>
<body onload="init()">
    <div id="myDiagramDiv" style="width: 100%; height: 600px; border: 1px solid black;"></div>
</body>
</html>
